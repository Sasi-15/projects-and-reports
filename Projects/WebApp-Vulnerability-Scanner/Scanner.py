import requests
from bs4 import BeautifulSoup
import os

# === Load Payloads ===
with open("payloads/xss.txt", "r") as file:
    xss_payloads = [line.strip() for line in file.readlines()]

with open("payloads/sql.txt", "r") as file:
    sql_payloads = [line.strip() for line in file.readlines()]

# === Target Input ===
url = input("Enter target URL: ")

try:
    res = requests.get(url)
    soup = BeautifulSoup(res.text, "html.parser")
    forms = soup.find_all("form")

    print(f"[+] Found {len(forms)} forms.")
    report = []

    for i, form in enumerate(forms):
        action = form.get("action")
        method = form.get("method", "get").lower()
        inputs = form.find_all("input")

        form_url = url if not action else url.rstrip("/") + "/" + action.lstrip("/")
        print(f"\n[+] Testing form {i+1}: {form_url} [{method.upper()}]")

        for payload_type, payload_list in [("XSS", xss_payloads), ("SQLi", sql_payloads)]:
            for payload in payload_list:
                data = {}
                for input_tag in inputs:
                    name = input_tag.get("name")
                    if name:
                        data[name] = payload

                if method == "post":
                    r = requests.post(form_url, data=data)
                else:
                    r = requests.get(form_url, params=data)

                if payload in r.text:
                    print(f"  [!] Possible {payload_type} vulnerability with payload: {payload}")
                    report.append(f"Form {i+1} | {payload_type} | Payload: {payload}")

    # === Save to results/scan-report.txt ===
    result_path = os.path.join("results", "scan-report.txt")
    with open(result_path, "w") as result_file:
        result_file.write("\n".join(report))

    print(f"\nâœ… Scan complete. Results saved to {result_path}")

except Exception as e:
    print(f"[ERROR] {e}")
